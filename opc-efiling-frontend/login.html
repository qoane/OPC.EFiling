<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />
  <title>OPC E-Filing — Login</title>

  <!-- Bootstrap 5 CSS (CDN) -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>
<body style="background-color: #f8f9fa;">
  <div class="container d-flex align-items-center justify-content-center" style="min-height: 100vh;">
    <div class="row w-100">
      <div class="col-md-6 col-lg-4 mx-auto">
        <div class="card border-0 shadow-sm">
          <div class="card-body p-5">
            <h1 class="h3 mb-4 text-center">Login to Your Account</h1>

            <!-- *** Assign an ID so we can hook JS onto it *** -->
            <form id="loginForm" novalidate>
              <!-- Email address -->
              <div class="mb-3">
                <label for="inputEmail" class="form-label">Email address</label>
                <input
                  type="email"
                  class="form-control"
                  id="inputEmail"
                  placeholder="name@example.com"
                  required
                />
                <div class="invalid-feedback">
                  Please enter a valid email address.
                </div>
              </div>

              <!-- Password -->
              <div class="mb-4">
                <label for="inputPassword" class="form-label">Password</label>
                <input
                  type="password"
                  class="form-control"
                  id="inputPassword"
                  placeholder="Enter your password"
                  required
                />
                <div class="invalid-feedback">
                  Please enter your password.
                </div>
              </div>

              <div class="d-grid mb-3">
                <button id="btnLogin" class="btn btn-primary" type="submit">
                  Login
                </button>
              </div>

              <!-- Forgot Password Link -->
              <div class="text-center">
                <a href="#" class="link-primary">Forgot password?</a>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap 5 JS & Popper (CDN) -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
  ></script>

  <!-- ==================== LOGIN SCRIPT ==================== -->
  <script>
    (function () {
      // Form validation (Bootstrap) – this part just toggles the 'was-validated' class
      const forms = document.querySelectorAll('#loginForm');
      Array.from(forms).forEach(function (form) {
        form.addEventListener(
          'submit',
          function (event) {
            if (!form.checkValidity()) {
              event.preventDefault();
              event.stopPropagation();
              form.classList.add('was-validated');
              return;
            }
            // If valid, prevent regular submit and call API instead
            event.preventDefault();
            sendLoginRequest();
          },
          false
        );
      });

      async function sendLoginRequest() {
        const email = document.getElementById('inputEmail').value.trim();
        const password = document.getElementById('inputPassword').value.trim();

        // Simple client‐side check (should already be valid if we reach here)
        if (!email || !password) {
          alert('Both email and password are required.');
          return;
        }

        try {
          // Make sure your API is running on port 5000 (default). Adjust if needed.
          const response = await fetch('http://localhost:5000/api/Auth/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email: email, password: password })
          });

          if (!response.ok) {
            // 401 or 400 from the API
            alert('Login failed: ’ + (await response.text()));
            return;
          }

          const data = await response.json();
          // The API returns { “token”: “<JWT_STRING>” }
          localStorage.setItem('jwtToken', data.token);

          // Redirect to dashboard (adjust filename if needed)
          window.location.href = 'dashboard.html';
        } catch (err) {
          console.error(err);
          alert('An unexpected error occurred during login.');
        }
      }
    })();
  </script>
</body>
</html>
